After the first setup, the Orange Box will continue working in "normal" operation mode.  

If the WiFi network was found during the first setup, every time the Orange Box is powered on in the future, it will connect to the same network, and it should start functioning normally after about 30 seconds.

The normal operation workflow is summarized as follows:
1. Power on the system with a push of a button.
1. After about 30 seconds, the Orange Box will connect to the WiFi network and it will be ready for data collection. This is confirmed by a green flashing LED on the Rock Pi computer.
1. Plug in the Blue box in any of the USB ports. The device will be appropriately numbered. This way it is easy to match the recorded data to the physical sensor unit and its location on the plant.
1. The measuring should start automatically after 5 seconds. (See Notes below.)
1. To finish measuring, disconnect the Blue box from the USB port. The next time it is reconnected, measuring starts again.
1. Start the "edge_device" program on your computer. A new terminal window will open to display various status messages. The first message informs the user at what time the program has started listening for data messages from the Orange Box. Next, a message will be displayed every time a new CSV file is created. There should be one file for power measurements and up to three for connected Blue boxes. It may take some time until the program receives data.
1. Start the "user_app" program on your computer. A new terminal window will open but it can be ignored. Navigate to `http://127.0.0.1:8050` in your browser.
1. The "user_app" program periodically reads the CSV files located in your measurements folder and plots the data accordingly. Make sure to select the correct Orange Box and USB port used for collecting the data (more details in the next section).
1. You can freely close and reopen your browser at any time. If you close the terminal window related to the "user_app", the browser interface will not function and you will have to start the program again.
1. DO NOT close the terminal window related to the "edge_device". If you do, your computer will stop receiving data.
1. In case the Orange Box needs to be updated, you will have to reboot it. You can do that through the "user_app".
1. Before you power off the Orange Box, please use the Shutdown button in the "user_app". Orange Box can then be safely powered off with a push of the button after a few seconds.
1. Use your preferred tool to analyze the collected data.

## Details about measurements
Measurements are stored locally on the Orange Box (Rock Pi computer). They are located in `/home/rock/measurements/`.  
If the Edge device is connected and "data_sink" program is running, the measurements are also stored on that computer in `<home>/measurements`.

The whole line of data coming from the Blue box is sent via ZeroMQ protocol to the Edge device, but not all sensor values available from the Blue box are saved to the CSV files to reduce their sizes (e.g. acceleration and empty fields).

To change which fields are saved on the Orange Box, navigate to 
```
/home/rock/OrangeBox/drivers/mu_interface/mu_interface/Utilities/config/default_data_fields.yaml
```
and set the value of each sensor you want to include to `True`. See [5. Advanced](5.-Advanced) to learn how to access this file. We are planning to simplify this process in the future.

To change which fields are saved on the Edge device computer, edit `custom_data_fields.yaml` file in the same way. This file should be located in the same folder as the Edge device executables. If this file is not present, defaults will be used.

## User app
The user interface available through the web browser is shown below. Important areas are marked in red.
<p align="center">
<img src="https://github.com/WatchPlant/OrangeBox/assets/18334507/43b347d8-c768-4b79-be50-b9cb9142e7b3" width="1000">
</p>


## Notes
1. Automatic collection of data usually starts 5 seconds after connecting the Blue box. However, Blue boxes sometimes do not respond to commands because of a yet unknown reason. We have discovered that reopening the serial communication port with a different baud rate circumvents the problem. This procedure takes around 15 seconds.
1. When updating the measuring frequency, the new desired value is written in a file and applied the next time Orange Box is rebooted.
